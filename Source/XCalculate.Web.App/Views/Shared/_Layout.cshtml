<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <title>@ViewData["Title"] - XCalculate</title>
    <link rel="stylesheet" href="~/css/site.min.css" />
</head>
<body>
    <div class="d-flex flex-column justify-content-between">
        <div>
            <nav class="navbar navbar-expand-md navbar-light bg-light">
                <a class="navbar-brand" href="~/">XCalculate</a>
                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#topNavbarToggle" aria-controls="topNavbarToggle" aria-expanded="false" aria-label="Toggle top navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="topNavbarToggle">
                    <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                        <li class="nav-item active">
                            <a class="nav-link" href="#">Home <span class="sr-only">(current)</span></a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#">Link</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link disabled" href="#">Disabled</a>
                        </li>
                    </ul>
                    <form class="form-inline my-2 my-lg-0 ml-auto">
                        <input id="nav-search" class="form-control mr-sm-2" type="search" placeholder="Search">
                        <button class="btn btn-outline-success my-2 my-sm-0" type="submit" onclick="return onClickNavSearch(this);">Search</button>
                    </form>
                </div>
            </nav>
            <div class="d-flex">
                <div class="mt-1">
                    <ul id="sidebar" class="nav flex-column">
                        <li class="nav-item"><a class="nav-link" href="/Calculator/?s=algebra" onclick="return onClickAjaxHelper(this);">Algebra</a></li>
                        <li class="nav-item"><a class="nav-link" href="/Search/?s=geometry">Geometry</a></li>
                        <li class="nav-item"><a class="nav-link" href="/Search/?s=trigonometry">Trigonometry</a></li>
                        <li class="nav-item"><a class="nav-link" href="/Search/?s=financial">Financial</a></li>
                    </ul>
                </div>
                <main class="container mt-2">
                    @RenderBody()
                </main>
            </div>
        </div>
        <footer class="text-center py-1">
            <hr />
            <span class="text-muted">&copy; 2019 - <a href="http://www.digimodern.com">DigiModern Software Solutions Incorporated</a></span>
        </footer>
    </div>
    <script src="~/js/site.min.js"></script>
    <script src="~/js/navigationUrl.js"></script>
    @RenderSection("Scripts", required: false)
    <script type="text/javascript">
        //var observer = new MutationObserver(onMutationObserved);

        $(document).ready(function () {
            //observer.observe($("main"), {
            //    childList: true
            //});
        });

        function onMutationObserved(mutationsList, observer) {
            for (var mutation of mutationsList) {
                if (mutation.type == "childList") {
                    console.log("A child node has been added or removed.");
                }
            }
        }

        function onClickAjaxHelper(e, config) {
            config = config ? config : {};

            var url = "";

            if (e instanceof String) {
                url = e;
            }
            else if (e instanceof HTMLAnchorElement) {
                url = e.toString();
            }
            else {
                throw new Error("Unknown type of URL input.");
            }

            var type = config.type ? config.type : "GET";
            var contentType = config.contentType ? config.contentType : false;
            var node = config.node ? config.node : "main";
            var action = config.action ? config.action : "contain";

            $.ajax({
                type: type,
                url: url,
                contentType: contentType,
                success: function (data, status) {
                    navigationUrl().updateUrl({ url: url });
                    if (action === "contain") {
                        $(node).html(data);
                    }
                    else if (action === "replace") {
                        $(node).replaceWith(data);
                    }
                    else {
                        throw new Error("Unknown action");
                    }
                },
                error: function (xhr, status, error) {
                    console.log(`AJAX error - status: ${status}; error: ${JSON.string(error)}`);
                }
            });

            return false;
        }

        function onClickNavSearch(e) {
            var term = $("#nav-search").val();

            if (term) {
                var authority = `${location.protocol}//${location.host}`;
                var url = `${authority}/Calculator/?s=${term}`;

                var navUrl = navigationUrl();
                navUrl.goToUrl(url);
            }
            return false;
        }
    </script>
</body>
</html>
